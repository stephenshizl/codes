#!/bin/bash

MACH=$1
FLASH_HOME=""
IMG_HOME=/home/june/work/images
OUT_HOME=out/target/product/macallan
DAILY_HOME=/home/june/work/images/daily_build
TEGRA_HOME=/home/june/work/server4/
WEEKLY_HOME=/home/june/work/images/weekly_build
DATE=`date +"%Y%m%d"`

all_images="recovery.img system.img boot.img bootloader.bin
		charged.bmp charging.bmp eks.dat flash.bct flash.cfg
			fullycharged.bmp lowbat.bmp nvidia.bmp tegra114-macallan.dtb
				xusb_sil_rel_fw userdata.img"

case $2 in
	-a)
		images=${all_images}
		shift 1
		;;
	*)
		
		images=${@:2}
		;;
esac

if [ ${@:${#@}} == "-s" ]; then
	FLASH_HOME=$DAILY_HOME/$MACH/$DATE
else
	FLASH_HOME=$TEGRA_HOME
fi

for i in ${images[@]};do
	[ $i == "-s" ] && break
	echo "diff $i"
	if ! diff -q $FLASH_HOME/$i $IMG_HOME/$MACH/$i > /dev/null ; then
		echo "copy "$i" ..."
		cp $FLASH_HOME/$i $IMG_HOME/$MACH/
		[ $? -ne 0 ] && exit;
	fi
done
